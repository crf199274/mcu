C51 COMPILER V9.60.7.0   DC_DC                                                             04/05/2023 18:17:11 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DC_DC
OBJECT MODULE PLACED IN .\Objects\DC_DC.obj
COMPILER INVOKED BY: E:\software\keil5_v5\C51\BIN\C51.EXE DC_DC.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\DC_DC) DEBUG 
                    -OBJECTEXTEND PRINT(.\Listings\DC_DC.lst) TABS(2) OBJECT(.\Objects\DC_DC.obj)

line level    source

   1          #include "DC_DC.h"
   2          #include "delay.h"
   3          #include "oled.h"
   4          
   5          uint16_t     pwm;                //定义PWM输出高电平的时间的变量。用户操作PWM的变量。
   6          
   7          float VOL = VOL_MIN;
   8          
   9          int pwm_error = 0;
  10          
  11          uint16_t VOL_OCC(float vol)
  12          {
  13   1        if(vol<VOL_MIN||vol>VOL_MAX)
  14   1          return pwm;
  15   1        
  16   1        return pwm_map(1.0-(vol-VOL_LIMIT_MIN)/(VOL_LIMIT_MAX-VOL_LIMIT_MIN));
  17   1      }
  18          
  19          
  20          //ooc>=0 | occ<=1
  21          uint16_t pwm_map(float occ)
  22          {
  23   1        if(occ>=1)
  24   1          return 0;
  25   1        else if(occ<=0)
  26   1          return CYCLE;
  27   1        else
  28   1          return CYCLE*occ;
  29   1          
  30   1      }
  31          
  32          void LoadPWM(uint16_t i)
  33          {
  34   1        if(i>CYCLE)
  35   1          i = CYCLE;
  36   1        
  37   1        P_SW2=0X80;
  38   1        
  39   1        PWMCFG = 0x00;          //关闭PWM模块
  40   1        
  41   1        PWM0T1 = i;
  42   1        PWM0T2 = 0x0000;
  43   1        
  44   1        PWMCFG = 0x01;          //启动PWM模块
  45   1        
  46   1      }
  47          
  48          
  49          void DC_DC_PWM_Init(void)
  50          {
  51   1        PWMSET = 0x01;          //使能PWM模块(必须先使能模块后面的设置才有效)
  52   1        
  53   1        P_SW2 = 0x80;
  54   1        PWMCKS = 0x00;          //PWM时钟为系统时钟
C51 COMPILER V9.60.7.0   DC_DC                                                             04/05/2023 18:17:11 PAGE 2   

  55   1        PWMC = CYCLE;           //设置PWM周期为1000H 个PWM时钟
  56   1        PWM0T1 = 0x0000;        //在计数值为0000H 地方PWM0 通道输出低电平
  57   1        PWM0T2 = 0x0000;        //在计数值为0000H 地方PWM0 通道输出高电平
  58   1        PWM0CR = 0x80;          //使能PWM0 输出
  59   1        P_SW2 = 0x00;
  60   1        
  61   1        PWMCFG = 0x01;          //启动PWM模块
  62   1      
  63   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    300    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      8       8
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
