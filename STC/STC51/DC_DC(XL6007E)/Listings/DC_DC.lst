C51 COMPILER V9.60.7.0   DC_DC                                                             02/19/2023 18:23:56 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DC_DC
OBJECT MODULE PLACED IN .\Objects\DC_DC.obj
COMPILER INVOKED BY: E:\software\keil5_v5\C51\BIN\C51.EXE DC_DC.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\DC_DC) DEBUG OBJECT
                    -EXTEND PRINT(.\Listings\DC_DC.lst) TABS(2) OBJECT(.\Objects\DC_DC.obj)

line level    source

   1          #include "DC_DC.h"
   2          #include "delay.h"
   3          #include "lcd.h"
   4          
   5          uint16_t     pwm;                //定义PWM输出高电平的时间的变量。用户操作PWM的变量。
   6          
   7          sbit    P_PWM = P3^5;       //定义PWM输出引脚。
   8          
   9          uint16_t     PWM_high,PWM_low;   //中间变量，用户请勿修改。
  10          
  11          float VOL = VOL_MIN;
  12          
  13          uint16_t VOL_OCC(float vol)
  14          {
  15   1        if(vol<VOL_MIN||vol>VOL_MAX)
  16   1          return pwm;
  17   1        
  18   1        return pwm_map(1.0-(vol-VOL_LIMIT_MIN)/(VOL_LIMIT_MAX-VOL_LIMIT_MIN));
  19   1      }
  20          
  21          
  22          //ooc>=0 | occ<=1
  23          uint16_t pwm_map(float occ)
  24          {
  25   1        if(occ>=1)
  26   1          return PWM_HIGH_MIN;
  27   1        else if(occ<=0)
  28   1          return PWM_HIGH_MAX;
  29   1        else
  30   1          return PWM_HIGH_MAX*occ;
  31   1          
  32   1      }
  33          
  34          void LoadPWM(uint16_t i)
  35          {
  36   1          uint16_t j;
  37   1      
  38   1          if(i > PWM_HIGH_MAX)        i = PWM_HIGH_MAX;   //如果写入大于最大占空比数据，则强制为最大占空比。
  39   1          if(i < PWM_HIGH_MIN)        i = PWM_HIGH_MIN;   //如果写入小于最小占空比数据，则强制为最小占空比。
  40   1          j = 65536UL - PWM_DUTY + i; //计算PWM低电平时间
  41   1          i = 65536UL - i;            //计算PWM高电平时间
  42   1          EA = 0;
  43   1          PWM_high = i;   //装载PWM高电平时间
  44   1          PWM_low  = j;   //装载PWM低电平时间
  45   1          EA = 1;
  46   1      }
  47          
  48          
  49          void DC_DC_PWM_Init(void)
  50          {
  51   1        P_PWM = 0;
  52   1        P3M1 &= ~(1 << 5);  //P3.5 设置为推挽输出
  53   1        P3M0 |=  (1 << 5);
  54   1      
C51 COMPILER V9.60.7.0   DC_DC                                                             02/19/2023 18:23:56 PAGE 2   

  55   1        
  56   1        TR0 = 0;        //停止计数
  57   1        ET0 = 1;        //允许中断
  58   1        PT0 = 1;        //高优先级中断
  59   1        TMOD &= ~0x03;  //工作模式,0: 16位自动重装
  60   1        AUXR |=  0x80;  //1T
  61   1        TMOD &= ~0x04;  //定时
  62   1        INT_CLKO |=  0x01;  //输出时钟
  63   1      
  64   1        
  65   1        TH0 = 0;
  66   1        TL0 = 0;
  67   1        TR0 = 1;    //开始运行
  68   1        
  69   1        pwm = VOL_OCC(VOL);
  70   1        LoadPWM(pwm);
  71   1      
  72   1      }
  73          
  74          void timer0_int (void) interrupt 1
  75          {
  76   1          if(P_PWM)
  77   1          {
  78   2              TH0 = (uint8_t)(PWM_low >> 8);   //如果是输出高电平，则装载低电平时间。
  79   2              TL0 = (uint8_t)PWM_low;
  80   2          }
  81   1          else
  82   1          {
  83   2              TH0 = (uint8_t)(PWM_high >> 8);  //如果是输出低电平，则装载高电平时间。
  84   2              TL0 = (uint8_t)PWM_high;
  85   2          }
  86   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    315    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
