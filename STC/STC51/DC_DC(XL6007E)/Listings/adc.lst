C51 COMPILER V9.60.7.0   ADC                                                               02/19/2023 18:20:03 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE ADC
OBJECT MODULE PLACED IN .\Objects\adc.obj
COMPILER INVOKED BY: E:\software\keil5_v5\C51\BIN\C51.EXE adc.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\DC_DC) DEBUG OBJECTEX
                    -TEND PRINT(.\Listings\adc.lst) TABS(2) OBJECT(.\Objects\adc.obj)

line level    source

   1          #include "adc.h"
   2          #include "lcd.h"
   3          
   4          uint8_t ch = 0;
   5          
   6          int AD_Value = 0;
   7          
   8          /*----------------------------
   9          软件延时
  10          ----------------------------*/
  11          void Delay_ADC(uint16_t n)
  12          {
  13   1          uint16_t x;
  14   1      
  15   1          while (n--)
  16   1          {
  17   2              x = 5000;
  18   2              while (x--);
  19   2          }
  20   1      }
  21          
  22          /*----------------------------
  23          初始化ADC
  24          ----------------------------*/
  25          void ADC_Config()
  26          {
  27   1          P1ASF = 0xff;                   //设置P1口为AD口
  28   1          ADC_RES = 0;                    //清除结果寄存器
  29   1          ADC_CONTR = ADC_POWER | ADC_SPEEDLL | ADC_START | ch;
  30   1          Delay_ADC(2);                       //ADC上电并延时
  31   1      }
  32          
  33          void adcInit(void)
  34          {
  35   1        ADC_Config();                      //初始化ADC
  36   1        IE = 0xa0;                      //使能ADC中断
  37   1                                        //开始AD转换
  38   1        
  39   1      }
  40          
  41          /*----------------------------
  42          ADC中断服务程序
  43          ----------------------------*/
  44          void adc_isr() interrupt 5
  45          {
  46   1          ADC_CONTR &= !ADC_FLAG;         //清除ADC中断标志
  47   1          
  48   1          AD_Value = ADC_RES<<2;
  49   1          AD_Value = AD_Value|(ADC_RESL&0x03);
  50   1        
  51   1          if(ch==0)
  52   1            VOUT = AD_Value*(5/1024.0)*4;
  53   1          else
  54   1            VIN = AD_Value*(5/1024.0)*4;
C51 COMPILER V9.60.7.0   ADC                                                               02/19/2023 18:20:03 PAGE 2   

  55   1        
  56   1          if(++ch>1)
  57   1            ch = 0;
  58   1          ADC_CONTR = ADC_POWER | ADC_SPEEDLL | ADC_START | ch;
  59   1      
  60   1          
  61   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    202    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
