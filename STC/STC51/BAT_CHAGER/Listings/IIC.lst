C51 COMPILER V9.60.7.0   IIC                                                               02/28/2023 03:21:41 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE IIC
OBJECT MODULE PLACED IN .\Objects\IIC.obj
COMPILER INVOKED BY: E:\software\keil5_v5\C51\BIN\C51.EXE IIC.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(
                    -.\Listings\IIC.lst) TABS(2) OBJECT(.\Objects\IIC.obj)

line level    source

   1          #include "IIC.h"
   2          #include "delay.h"
   3          #include "stc15.h"
   4          #include "typedef.h"
   5          #include "intrins.h"
   6          
   7          sbit OLED_SDA = P3^5;
   8          sbit OLED_SCL = P3^4;
   9          
  10          //起始信号
  11          void iic_start(void)
  12          {
  13   1        OLED_SDA = 1;
  14   1        OLED_SCL = 1;
  15   1        Delay5us();//5us
  16   1        OLED_SDA = 0;
  17   1        Delay6us();//6us
  18   1        OLED_SCL = 0;
  19   1      }
  20          
  21          //停止信号
  22          void iic_stop(void)
  23          {
  24   1        OLED_SCL = 0;
  25   1        OLED_SDA = 0;
  26   1        OLED_SCL = 1;
  27   1        Delay6us();//6us
  28   1        OLED_SDA = 1;
  29   1        Delay6us();//6us
  30   1      }
  31          
  32          //等待应答
  33          unsigned char iic_wait_ack(void)
  34          {
  35   1        unsigned char temptime=0;
  36   1        OLED_SDA = 1;
  37   1        _nop_();
  38   1        _nop_();//1us
  39   1        OLED_SCL = 1;
  40   1        _nop_();
  41   1        _nop_();//1us
  42   1        while(OLED_SDA)
  43   1        {
  44   2          temptime++;
  45   2          if(temptime>250)
  46   2          {
  47   3            iic_stop();
  48   3            return 1;
  49   3          }
  50   2        }
  51   1        OLED_SCL = 0;
  52   1        return 0;
  53   1      }
  54          
C51 COMPILER V9.60.7.0   IIC                                                               02/28/2023 03:21:41 PAGE 2   

  55          //应答
  56          //void iic_ack(void)
  57          //{
  58          //  OLED_SCL = 0;
  59          //  OLED_SDA = 0;
  60          //  delay_07us(3);//2us
  61          //  OLED_SCL = 1;
  62          //  Delay5us();//5us
  63          //  OLED_SCL = 0;
  64          //}
  65          
  66          //非应答
  67          //void iic_nack(void)
  68          //{
  69          //  OLED_SCL = 0;
  70          //  OLED_SDA = 1;
  71          //  delay_07us(3);//2us
  72          //  OLED_SCL = 1;
  73          //  Delay5us();//5us
  74          //  OLED_SCL = 0;
  75          //}
  76          
  77          //数据发送
  78          void iic_send_byte(unsigned char mdata)
  79          {
  80   1        unsigned char t;
  81   1        OLED_SCL = 0;
  82   1        for(t=0;t<8;t++)
  83   1        {
  84   2          if((mdata&0x80)>0)
  85   2            OLED_SDA = 1;
  86   2          else
  87   2            OLED_SDA = 0;
  88   2          mdata<<=1;
  89   2          Delay2us();//2us
  90   2          OLED_SCL = 1;
  91   2          Delay2us();//2us
  92   2          OLED_SCL = 0;
  93   2          Delay2us();//2us
  94   2        }
  95   1      }
  96          
  97          //数据读取
  98          //unsigned char iic_read_byte(unsigned char ack)
  99          //{
 100          //  unsigned char i=0,mdata=0;
 101          //  for(i=0;i<8;i++)
 102          //  {
 103          //    OLED_SCL = 0;
 104          //    delay_07us(3);//2us
 105          //    OLED_SCL = 1;
 106          //    mdata<<=1;
 107          //    if(OLED_SDA)
 108          //      mdata++;
 109          //    delay_07us(2);//2us
 110          //  }
 111          //  if(!ack)
 112          //    iic_nack();
 113          //  else
 114          //    iic_ack();
 115          //  return mdata;
 116          //}
C51 COMPILER V9.60.7.0   IIC                                                               02/28/2023 03:21:41 PAGE 3   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    121    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
