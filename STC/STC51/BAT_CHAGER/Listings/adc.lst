C51 COMPILER V9.60.7.0   ADC                                                               02/28/2023 02:29:55 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE ADC
OBJECT MODULE PLACED IN .\Objects\adc.obj
COMPILER INVOKED BY: E:\software\keil5_v5\C51\BIN\C51.EXE adc.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(
                    -.\Listings\adc.lst) TABS(2) OBJECT(.\Objects\adc.obj)

line level    source

   1          #include "adc.h"
   2          #include "oled.h"
   3          #include "stc15.h"
   4          
   5          uint8_t ch = 0;
   6          
   7          int AD_Value = 0;
   8          
   9          /*----------------------------
  10          软件延时
  11          ----------------------------*/
  12          void Delay_ADC(uint16_t n)
  13          {
  14   1          uint16_t x;
  15   1      
  16   1          while (n--)
  17   1          {
  18   2              x = 5000;
  19   2              while (x--);
  20   2          }
  21   1      }
  22          
  23          /*----------------------------
  24          初始化ADC
  25          ----------------------------*/
  26          void ADC_Config()
  27          {
  28   1          P1ASF = 0xff;                   //设置P1口为AD口
  29   1          ADC_RES = 0;                    //清除结果寄存器
  30   1          ADC_CONTR = ADC_POWER | ADC_SPEEDLL | ADC_START | ch;
  31   1          Delay_ADC(2);                       //ADC上电并延时
  32   1      }
  33          
  34          void adcInit(void)
  35          {
  36   1        ADC_Config();                      //初始化ADC
  37   1        IE = 0xa0;                      //使能ADC中断
  38   1                                        //开始AD转换
  39   1        
  40   1      }
  41          
  42          /*----------------------------
  43          ADC中断服务程序
  44          ----------------------------*/
  45          void adc_isr() interrupt 5
  46          {
  47   1          ADC_CONTR &= !ADC_FLAG;         //清除ADC中断标志
  48   1          
  49   1          AD_Value = ADC_RES<<2;
  50   1          AD_Value = AD_Value|(ADC_RESL&0x03);
  51   1        
  52   1          if(ch==0)
  53   1            IOUT3 = AD_Value*IOUT3_K;
  54   1          else if(ch==1)
C51 COMPILER V9.60.7.0   ADC                                                               02/28/2023 02:29:55 PAGE 2   

  55   1            IOUT1 = AD_Value*IOUT1_K;
  56   1          else if(ch==2)
  57   1            IOUT2 = AD_Value*IOUT2_K;
  58   1          else if(ch==3)
  59   1            VOUT2 = AD_Value*VOUT2_K;
  60   1          else if(ch==4)
  61   1            VOUT3 = AD_Value*VOUT3_K;
  62   1          else
  63   1            VOUT1 = AD_Value*VOUT1_K;
  64   1        
  65   1          if(++ch>5)
  66   1            ch = 0;
  67   1          ADC_CONTR = ADC_POWER | ADC_SPEEDLL | ADC_START | ch;
  68   1      
  69   1          
  70   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    388    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      3    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
